---
title: '626'
author: "Nicholas Ray"
date: "1/26/2023"
output: pdf_document
---
```{r Libraries, message=FALSE, warning=FALSE}
library(here); library(readxl); library(tidyverse)
```
```{r Data, message=FALSE, warning=FALSE}
cmp<-read_csv(here("CMP.zip"))
wto<-read_xlsx(here("WtoData_20230208175246.xlsx"),skip = 1)
```
```{r Cleaning}
cmp<-cmp %>%
  mutate(date=gsub('../../','',edate),date=as.numeric(date)) %>%
  select(-country,-oecdmember,-eumember,-edate,-party,-partyabbrev,-coderid,-manual,-coderyear,-testresult,-testeditsim,-voteest,-presvote,-progtype,-datasetorigin,-corpusversion,-total,-peruncod)
#per109:internationalism_negative,per406:protectionism_positive,per608:multiculturalism_negative,per601:national_...
cmp2 <- cmp %>% #building lg_anti
  filter(date>1989 & date<2021) %>%
  group_by(countryname,partyname) %>%
  summarise(anti=round(mean(per109+per608),1),vote=round(mean(pervote),1),parfam=mean(parfam)) %>%
  mutate(lg_anti=ifelse(anti>1 & vote>10,1,0),lg_anti_natpar=ifelse(anti>1 & vote>10 & parfam==70,1,0))
cmp3<-cmp2 %>% #cmp4 but with only countries with lg_anti and their party names (allows us to see what parties in cmp4)
  filter(lg_anti==1)
cmp4<-cmp2 %>%
  drop_na() %>%#most condensed info, possibly table for paper
  group_by(countryname) %>%
  summarise(lg_anti=sum(lg_anti),lg_anti_natpar=sum(lg_anti_natpar))
#wto
wto<-wto %>%
  filter(`Product/Sector`=='SI3_AGG - TO - Total merchandise') %>%
  pivot_longer("1979":"2021",values_to = "exports",names_to = "date") %>%
  select(-`Partner Economy`,-`Product/Sector`) %>%
  rename(countryname=`Reporting Economy`) %>%
  mutate(date=as.numeric(date))
data<-cmp %>%
  left_join(wto,by=c("countryname","date"))
```

May be able to argue that if `lg_anti` is 0, then incumbent political system has failed to respond to anti-globalist sentiment IF it exists.

Deeper case studies: Looking at Austria, and how it's 2 "anti-globalist" parties have changed in political power over the years. Can also include graph for measure of globalization...

Really trying to look at how these two items that are supposed to measure anti-globalization politics (per109, per608) changes over time, along with how an objective measure of globalization has changed over time. Then want to see if "incumbents" responded to globalization or if others did. Austria is a great example, where it seems that the Austrian Freedom Party championed anti-globalist issues after already being prominent in the parliament. Hence, this incumbent system adapted to, or even tried to appease the losers of, globalization. 

```{r Graphs}
graph<-function(country,party,scale){
  title<-c(country, party)
  data %>%
  filter(countryname==country,partyname==party) %>%
  ggplot(aes(x=date)) +
    geom_line(aes(y=(per109+per608),color="anti")) +
    geom_line(aes(y=(pervote),color="vote")) +
    geom_line(aes(y=((exports/scale)),color="exports")) +
    labs(title = paste0(c(title), collapse = ", "))
}
parties<-function(country){
  cmp %>%
    filter(date>1979,countryname==country) %>%
    group_by(partyname) %>%
    summarise(y=mean(pervote)) %>%
    mutate(z=ifelse(y>5,1,0)) %>%
    filter(z==1)
}
#austria: example of country where established party became anti-globalist as trade increased (1)
parties('Austria')
graph('Austria','Austrian Freedom Party',10000)
#belgium: really not to much growth in anti-globalization (0)
parties('Belgium')
graph('Belgium','New Flemish Alliance',10000)
graph('Belgium','Christian Democratic and Flemish',10000)
#Bosnia-Herzegovina: growth in anti-globalization both from established parties (1)
parties('Bosnia-Herzegovina')
graph('Bosnia-Herzegovina','Alliance of Independent Social Democrats',1000)
graph('Bosnia-Herzegovina','Serbian Democratic Party',1000)
#Bulgaria: false positive maybe (0)
parties('Bulgaria')
graph('Bulgaria',"Coalition of Bulgarian Socialist Party, Bulgarian Agrarian People’s Union - Alexandar Stambolijski and Political Club 'Ekoglasnost'",1000)
#Czech Republic: false alarm (0)
graph('Czech Republic','Left Bloc',1000)
#denmark: could be an example of party becoming established after becoming anti-globalist
graph('Denmark','Danish People’s Party',10000)
```
