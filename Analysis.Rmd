---
title: '626'
author: "Nicholas Ray"
date: "1/26/2023"
output: pdf_document
---
```{r Libraries, message=FALSE, warning=FALSE}
library(here); library(readxl); library(tidyverse)
```
```{r Data, message=FALSE, warning=FALSE}
cmp<-read_csv(here("CMP.zip"))
wto<-read_xlsx(here("WtoData_20230208175246.xlsx"),skip = 1)
```
```{r Cleaning}
cmp<-cmp %>%
  mutate(date=gsub('../../','',edate),date=as.numeric(date)) %>%
  select(-country,-oecdmember,-eumember,-edate,-party,-partyabbrev,-coderid,-manual,-coderyear,-testresult,-testeditsim,-voteest,-presvote,-progtype,-datasetorigin,-corpusversion,-total,-peruncod)
#per109:internationalism_negative,per406:protectionism_positive,per608:multiculturalism_negative,per601:national_...
cmp5 <- cmp %>% #building lg_anti
  filter(date>1989 & date<2021) %>%
  group_by(countryname,partyname) %>%
  mutate(anti=(per109+per608)) #used for mean, sd of "anti"
cmp2 <- cmp %>% #building lg_anti
  filter(date>1989 & date<2021) %>%
  group_by(countryname,partyname) %>%
  summarise(anti=round(mean(per109+per608),1),vote=round(mean(pervote),1),parfam=mean(parfam)) %>%
  mutate(lg_anti=ifelse(anti>1 & vote>10,1,0),lg_anti_natpar=ifelse(anti>1 & vote>10 & parfam==70,1,0))
cmp3<-cmp2 %>% #cmp4 but with only countries with lg_anti and their party names (allows us to see what parties in cmp4)
  filter(lg_anti==1)
cmp4<-cmp2 %>%
  drop_na() %>%#most condensed info, possibly table for paper
  group_by(countryname) %>%
  summarise(lg_anti=sum(lg_anti),lg_anti_natpar=sum(lg_anti_natpar))
#wto
wto<-wto %>%
  filter(`Product/Sector`=='SI3_AGG - TO - Total merchandise') %>%
  pivot_longer("1979":"2021",values_to = "exports",names_to = "date") %>%
  select(-`Partner Economy`,-`Product/Sector`) %>%
  rename(countryname=`Reporting Economy`) %>%
  mutate(date=as.numeric(date))
data<-cmp %>%
  left_join(wto,by=c("countryname","date"))
```

May be able to argue that if `lg_anti` is 0, then incumbent political system has failed to respond to anti-globalist sentiment IF it exists.

Deeper case studies: Looking at Austria, and how it's 2 "anti-globalist" parties have changed in political power over the years. Can also include graph for measure of globalization...

Really trying to look at how these two items that are supposed to measure anti-globalization politics (per109, per608) changes over time, along with how an objective measure of globalization has changed over time. Then want to see if "incumbents" responded to globalization or if others did. Austria is a great example, where it seems that the Austrian Freedom Party championed anti-globalist issues after already being prominent in the parliament. Hence, this incumbent system adapted to, or even tried to appease the losers of, globalization. 

```{r Functions}
graph<-function(country,party,scale){ #scale unused unless graphing exports too
  title<-c(country, party)
  data %>%
  filter(countryname==country,partyname==party) %>%
  ggplot(aes(x=date)) +
    geom_line(aes(y=(per109+per608),color="Anti-Globalist Platform")) +
    geom_line(aes(y=(pervote),color="Vote Percentage")) +
    #geom_line(aes(y=((exports/scale)),color="exports"))
    labs(title = paste0(c(title), collapse = ", "),x="Year",y="")
}
parties<-function(country){
  cmp %>%
    filter(date>1979,countryname==country) %>%
    group_by(partyname) %>%
    summarise(y=mean(pervote)) %>%
    mutate(z=ifelse(y>5,1,0)) %>%
    filter(z==1)
}
```
```{r Graphs}
#rule should be if "Anti-Globalist Platform" was non-zero when they crossed 10% vote threshold
#examples of "incumbents" becoming anti-globalist (assumingly to appease losers) (case 1)
c1.1<-graph("Austria","Austrian Freedom Party", 10000)
c1.2<-graph("Austria","Austrian People’s Party", 10000)
c1.3<-graph('Bosnia-Herzegovina','Alliance of Independent Social Democrats',1000)
c1.4<-graph('Bosnia-Herzegovina','Serbian Democratic Party',1000)
c1.5<-graph('Denmark','Liberals',10000)
c1.6<-graph('Denmark','Social Democratic Party',10000)
c1.7<-graph("Switzerland","Swiss People’s Party",10000) #could be 1 or 2...
c1.8<-graph("Finland","Finnish Centre",1) #could be 1 or 2 #competition?
c1.9<-graph("France","Union for a Popular Movement",1) #competition?
c1.9<-graph("Germany","Christian Democratic Union/Christian Social Union",1)
c1.10<-graph("Luxembourg","Christian Social People’s Party",1)
c1.11<-graph("United States","Republican Party")
#
#examples of "far-right" entering (assumingly because incumbents have yet to appease losers) (case 2)
c2.1<-graph('Denmark','Danish People’s Party',10000)
c2.2<-graph("Sweden","Sweden Democrats",10000)
c2.3<-graph("Norway","Progress Party",10000) #could be 1 or 2...
c2.4<-graph("Mexico","Democratic Revolutionary Party",100000)
c2.5<-graph("Netherlands","Party of Freedom",100000)
c2.6<-graph("Netherlands","People’s Party for Freedom and Democracy",1)
c2.7<-graph("Finland","True Finns",1) #competition?
c2.8<-graph("France","National Front",1) #competition
c2.9<-graph("Hungary","Movement for a Better Hungary",1)
c2.10<-graph("Israel","Change",1)
c2.11<-graph("Italy","National Alliance",1)
c2.12<-graph("Japan","Japan Restoration Party",1)
c2.13<-graph("Romania","Greater Romania Party")
c2.14<-graph("Slovenia","Social-Democratic Party of Slovenia")
#
#countries where no anti-globalist party has surfaced
#every other democratic country... Canada, etc.
```
```{r Plots,fig.height= 10, fig.width= 10}
library(cowplot)
#case1
case1 <- plot_grid(
  c1.1 + theme(legend.position="none"),
  c1.2 + theme(legend.position="none"),
  c1.3 + theme(legend.position="none"),
  c1.4 + theme(legend.position="none"),
  c1.5 + theme(legend.position="none"),
  c1.6 + theme(legend.position="none"),
  c1.7 + theme(legend.position="none"),
  c1.8 + theme(legend.position="none"),
  c1.9 + theme(legend.position="none"),
  c1.10 + theme(legend.position="none"),
  c1.11 + theme(legend.position="none"),
  align = 'vh',
  #hjust = -1,
  ncol = 3
)
legend1 <- get_legend(
  c1.1 + 
    guides(color = guide_legend(nrow = 1)) +
    theme(legend.position = "bottom")
)
one<-plot_grid(case1,legend1, ncol = 1, rel_heights = c(1, .1))
#
#case2
#
case2 <- plot_grid(
  c2.1 + theme(legend.position="none"),
  c2.2 + theme(legend.position="none"),
  c2.3 + theme(legend.position="none"),
  c2.4 + theme(legend.position="none"),
  c2.5 + theme(legend.position="none"),
  c2.6 + theme(legend.position="none"),
  c2.7 + theme(legend.position="none"),
  c2.8 + theme(legend.position="none"),
  c2.9 + theme(legend.position="none"),
  c2.10 + theme(legend.position="none"),
  c2.11 + theme(legend.position="none"),
  c2.12 + theme(legend.position="none"),
  c2.13 + theme(legend.position="none"),
  c2.14 + theme(legend.position="none"),
  align = 'vh',
  #hjust = -1,
  ncol = 3
)
legend2 <- get_legend(
  c2.1 + 
    guides(color = guide_legend(nrow = 1)) +
    theme(legend.position = "bottom")
)
two<-plot_grid(case2,legend2, ncol = 1, rel_heights = c(1, .1))
```

